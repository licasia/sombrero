generator client {
  provider            = "prisma-client"
  output              = "../src/generated/prisma"
  importFileExtension = "js"
}

datasource db {
  provider = "sqlite"
}

model Escort {
  id                   Int      @id @default(autoincrement())
  extId                String?  @map("ext_id")
  isActive             Boolean? @map("is_active")
  name                 String?
  phone                String?
  passCode             String?  @map("pass_code")
  services             String?
  price                Int?
  year                 Int?
  height               Int?
  weight               Int?
  bust                 Int?
  waist                Int?
  hip                  Int?
  origin               String?
  city                 String?
  district             String?
  area                 String?
  workingHours         String?  @map("working_hours")
  extraFees            String?  @map("extra_fees")
  primaryImageUrl      String?  @map("primary_image_url")
  primaryImageFilename String?  @map("primary_image_filename")
  images               String?
  videoUrl             String?  @map("video_url")
  videoFilename        String?  @map("video_filename")
  description          String?
  address              String?
  validProfile         Boolean? @default(false) @map("valid_profile")

  fetchRunDetail      FetchRunDetail?
  @@map("escorts")
}

model FetchRunDetail {
  id       Int     @id @default(autoincrement())
  escortId Int?    @unique(map: "sqlite_autoindex_fetch_run_details_1") @map("escort_id")
  status   String?

  escort          Escort?          @relation(fields: [escortId], references: [id]) 
  processAttempts ProcessAttempt[]
  @@map("fetch_run_details")
}

model ProcessAttempt {
  id                Int       @id @default(autoincrement())
  fetchRunDetailId Int       @map("fetch_run_detail_id")
  fetchRunId        Int       @map("fetch_run_id")
  attemptNumber     Int?      @default(1) @map("attempt_number")
  result            String?
  isSuccess         Boolean?  @default(false) @map("is_success")
  failureReason     String?   @map("failure_reason")
  createdAt         DateTime? @default(now()) @map("created_at")

  fetchRunDetail    FetchRunDetail @relation(fields: [fetchRunDetailId], references: [id]) 
  fetchRun          FetchRun       @relation(fields: [fetchRunId], references: [id])

  @@map("process_attempts")
}

model FetchRun {
  id           Int       @id @default(autoincrement())
  runType      String    @map("run_type")
  llmModelUsed String?   @map("llm_model_used")
  inputData    String?   @map("input_data")
  rawResult    String?   @map("raw_result")
  status       String?   @default("pending") @map("status")
  createdAt    DateTime? @default(now()) @map("created_at")

  processAttempts ProcessAttempt[]

  @@map("fetch_runs")
}
